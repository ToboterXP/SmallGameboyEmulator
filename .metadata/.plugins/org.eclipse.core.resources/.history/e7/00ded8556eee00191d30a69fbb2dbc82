/*
 * i80_9f.h
 *
 *  Created on: 14.10.2019
 *      Author: Tobias
 */

#ifndef I80_9F_H_
#define I80_9F_H_


#include <cstdint>
#include "Processor.h"

namespace proc {

int execute80_9f(uint8_t opcode, Processor * proc) {
	switch (opcode) {
	case 0x80: //add a,b
		proc->setFlag(SUB_FLAG,0);
		uint8_t prev = proc->a;
		proc->a +=proc->b;
		proc->setFlag(CARRY_FLAG,prev>proc->a);
		proc->setFlag(HALF_CARRY_FLAG,(prev&0xf+ proc->b&0xf)&0x10==0x10);
		proc->setFlag(ZERO_FLAG,proc->a==0);
		return 1;
	case 0x81: //add a,c
		proc->setFlag(SUB_FLAG,0);
		uint8_t prev = proc->a;
		proc->a +=proc->c;
		proc->setFlag(CARRY_FLAG,prev>proc->a);
		proc->setFlag(HALF_CARRY_FLAG,(prev&0xf+ proc->c&0xf)&0x10==0x10);
		proc->setFlag(ZERO_FLAG,proc->a==0);
		return 1;
	case 0x82: //add a,d
		proc->setFlag(SUB_FLAG,0);
		uint8_t prev = proc->a;
		proc->a +=proc->d;
		proc->setFlag(CARRY_FLAG,prev>proc->a);
		proc->setFlag(HALF_CARRY_FLAG,(prev&0xf+ proc->d&0xf)&0x10==0x10);
		proc->setFlag(ZERO_FLAG,proc->a==0);
		return 1;
	case 0x83: //add a,e
		proc->setFlag(SUB_FLAG,0);
		uint8_t prev = proc->a;
		proc->a +=proc->e;
		proc->setFlag(CARRY_FLAG,prev>proc->a);
		proc->setFlag(HALF_CARRY_FLAG,(prev&0xf+ proc->e&0xf)&0x10==0x10);
		proc->setFlag(ZERO_FLAG,proc->a==0);
		return 1;
	case 0x84: //add a,h
		proc->setFlag(SUB_FLAG,0);
		uint8_t prev = proc->a;
		proc->a +=proc->h;
		proc->setFlag(CARRY_FLAG,prev>proc->a);
		proc->setFlag(HALF_CARRY_FLAG,(prev&0xf+ proc->h&0xf)&0x10==0x10);
		proc->setFlag(ZERO_FLAG,proc->a==0);
		return 1;
	case 0x85: //add a,l
		proc->setFlag(SUB_FLAG,0);
		uint8_t prev = proc->a;
		proc->a +=proc->l;
		proc->setFlag(CARRY_FLAG,prev>proc->a);
		proc->setFlag(HALF_CARRY_FLAG,(prev&0xf+ proc->l&0xf)&0x10==0x10);
		proc->setFlag(ZERO_FLAG,proc->a==0);
		return 1;
	case 0x86: //add a,(hl)
		proc->setFlag(SUB_FLAG,0);
		uint8_t prev = proc->a;
		uint8_t b = proc->memory->readMemory(proc->getHL());
		proc->a +=b;
		proc->setFlag(CARRY_FLAG,prev>proc->a);
		proc->setFlag(HALF_CARRY_FLAG,(prev&0xf+ b&0xf)&0x10==0x10);
		proc->setFlag(ZERO_FLAG,proc->a==0);
		return 2;
	case 0x87: //add a,a
		proc->setFlag(SUB_FLAG,0);
		uint8_t prev = proc->a;
		proc->a +=proc->a;
		proc->setFlag(CARRY_FLAG,prev>proc->a);
		proc->setFlag(HALF_CARRY_FLAG,(prev&0xf+ proc->a&0xf)&0x10==0x10);
		proc->setFlag(ZERO_FLAG,proc->a==0);
		return 1;
	case 0x88: //adc a,b
		proc->setFlag(SUB_FLAG,0);
		uint8_t prev = proc->a;
		uint8_t b = proc->b+proc->getFlag(CARRY_FLAG);
		proc->a += b;
		proc->setFlag(CARRY_FLAG,prev>proc->a);
		proc->setFlag(HALF_CARRY_FLAG,(prev&0xf+ b&0xf)&0x10==0x10);
		proc->setFlag(ZERO_FLAG,proc->a==0);
		return 1;
	case 0x89: //adc a,c
		proc->setFlag(SUB_FLAG,0);
		uint8_t prev = proc->a;
		uint8_t b = proc->c+proc->getFlag(CARRY_FLAG);
		proc->a += b;
		proc->setFlag(CARRY_FLAG,prev>proc->a);
		proc->setFlag(HALF_CARRY_FLAG,(prev&0xf+ b&0xf)&0x10==0x10);
		proc->setFlag(ZERO_FLAG,proc->a==0);
		return 1;
	case 0x8a: //adc a,d
		proc->setFlag(SUB_FLAG,0);
		uint8_t prev = proc->a;
		uint8_t b = proc->d+proc->getFlag(CARRY_FLAG);
		proc->a += b;
		proc->setFlag(CARRY_FLAG,prev>proc->a);
		proc->setFlag(HALF_CARRY_FLAG,(prev&0xf+ b&0xf)&0x10==0x10);
		proc->setFlag(ZERO_FLAG,proc->a==0);
		return 1;
	case 0x8b: //adc a,e
		proc->setFlag(SUB_FLAG,0);
		uint8_t prev = proc->a;
		uint8_t b = proc->e+proc->getFlag(CARRY_FLAG);
		proc->a += b;
		proc->setFlag(CARRY_FLAG,prev>proc->a);
		proc->setFlag(HALF_CARRY_FLAG,(prev&0xf+ b&0xf)&0x10==0x10);
		proc->setFlag(ZERO_FLAG,proc->a==0);
		return 1;
	case 0x8c: //adc a,h
		proc->setFlag(SUB_FLAG,0);
		uint8_t prev = proc->a;
		uint8_t b = proc->h+proc->getFlag(CARRY_FLAG);
		proc->a += b;
		proc->setFlag(CARRY_FLAG,prev>proc->a);
		proc->setFlag(HALF_CARRY_FLAG,(prev&0xf+ b&0xf)&0x10==0x10);
		proc->setFlag(ZERO_FLAG,proc->a==0);
		return 1;
	case 0x8d: //adc a,l
		proc->setFlag(SUB_FLAG,0);
		uint8_t prev = proc->a;
		uint8_t b = proc->l+proc->getFlag(CARRY_FLAG);
		proc->a += b;
		proc->setFlag(CARRY_FLAG,prev>proc->a);
		proc->setFlag(HALF_CARRY_FLAG,(prev&0xf+ b&0xf)&0x10==0x10);
		proc->setFlag(ZERO_FLAG,proc->a==0);
		return 1;
	case 0x8e: //adc a,(hl)
		proc->setFlag(SUB_FLAG,0);
		uint8_t prev = proc->a;
		uint8_t b = proc->memory->readMemory(proc->getHL())+proc->getFlag(CARRY_FLAG);
		proc->a += b;
		proc->setFlag(CARRY_FLAG,prev>proc->a);
		proc->setFlag(HALF_CARRY_FLAG,(prev&0xf+ b&0xf)&0x10==0x10);
		proc->setFlag(ZERO_FLAG,proc->a==0);
		return 2;
	case 0x8f: //adc a,a
		proc->setFlag(SUB_FLAG,0);
		uint8_t prev = proc->a;
		uint8_t b = proc->a+proc->getFlag(CARRY_FLAG);
		proc->a += b;
		proc->setFlag(CARRY_FLAG,prev>proc->a);
		proc->setFlag(HALF_CARRY_FLAG,(prev&0xf+ b&0xf)&0x10==0x10);
		proc->setFlag(ZERO_FLAG,proc->a==0);
		return 1;
	case 0x90: //sub a,b
		proc->setFlag(SUB_FLAG,1);
		uint8_t prev = proc->a;
		proc->a -=proc->b;
		proc->setFlag(CARRY_FLAG,prev<proc->a);
		proc->setFlag(HALF_CARRY_FLAG,(prev&0xf- proc->b&0xf)&0x10==0x10);
		proc->setFlag(ZERO_FLAG,proc->a==0);
		return 1;
	case 0x91: //sub a,c
		proc->setFlag(SUB_FLAG,1);
		uint8_t prev = proc->a;
		uint8_t b = proc->c;
		proc->a -=b;
		proc->setFlag(CARRY_FLAG,prev<proc->a);
		proc->setFlag(HALF_CARRY_FLAG,(prev&0xf- b&0xf)&0x10==0x10);
		proc->setFlag(ZERO_FLAG,proc->a==0);
		return 1;
	case 0x92: //sub a,d
		proc->setFlag(SUB_FLAG,1);
		uint8_t prev = proc->a;
		uint8_t b = proc->d;
		proc->a -=b;
		proc->setFlag(CARRY_FLAG,prev<proc->a);
		proc->setFlag(HALF_CARRY_FLAG,(prev&0xf- b&0xf)&0x10==0x10);
		proc->setFlag(ZERO_FLAG,proc->a==0);
		return 1;
	case 0x93: //sub a,e
		proc->setFlag(SUB_FLAG,1);
		uint8_t prev = proc->a;
		uint8_t b = proc->c;
		proc->a -=b;
		proc->setFlag(CARRY_FLAG,prev<proc->a);
		proc->setFlag(HALF_CARRY_FLAG,(prev&0xf- b&0xf)&0x10==0x10);
		proc->setFlag(ZERO_FLAG,proc->a==0);
		return 1;
	case 0x94: //sub a,h
		proc->setFlag(SUB_FLAG,1);
		uint8_t prev = proc->a;
		uint8_t b = proc->h;
		proc->a -=b;
		proc->setFlag(CARRY_FLAG,prev<proc->a);
		proc->setFlag(HALF_CARRY_FLAG,(prev&0xf- b&0xf)&0x10==0x10);
		proc->setFlag(ZERO_FLAG,proc->a==0);
		return 1;
	case 0x95: //sub a,l
		proc->setFlag(SUB_FLAG,1);
		uint8_t prev = proc->a;
		uint8_t b = proc->l;
		proc->a -=b;
		proc->setFlag(CARRY_FLAG,prev<proc->a);
		proc->setFlag(HALF_CARRY_FLAG,(prev&0xf- b&0xf)&0x10==0x10);
		proc->setFlag(ZERO_FLAG,proc->a==0);
		return 1;
	case 0x96: //sub a,(hl)
		proc->setFlag(SUB_FLAG,1);
		uint8_t prev = proc->a;
		uint8_t b = proc->memory->readMemory(proc->getHL());
		proc->a -=b;
		proc->setFlag(CARRY_FLAG,prev<proc->a);
		proc->setFlag(HALF_CARRY_FLAG,(prev&0xf- b&0xf)&0x10==0x10);
		proc->setFlag(ZERO_FLAG,proc->a==0);
		return 2;
	case 0x97: //sub a,a
		proc->setFlag(SUB_FLAG,1);
		uint8_t prev = proc->a;
		uint8_t b = proc->a;
		proc->a -=b;
		proc->setFlag(CARRY_FLAG,prev<proc->a);
		proc->setFlag(HALF_CARRY_FLAG,(prev&0xf- b&0xf)&0x10==0x10);
		proc->setFlag(ZERO_FLAG,proc->a==0);
		return 1;
	case 0x98: //sbc a,b
		proc->setFlag(SUB_FLAG,1);
		uint8_t prev = proc->a;
		uint8_t b = proc->b+proc->getFlag(CARRY_FLAG);
		proc->a -= b;
		proc->setFlag(CARRY_FLAG,prev<proc->a);
		proc->setFlag(HALF_CARRY_FLAG,(prev&0xf- b&0xf)&0x10==0x10);
		proc->setFlag(ZERO_FLAG,proc->a==0);
		return 1;
	case 0x99: //sbc a,c
		proc->setFlag(SUB_FLAG,1);
		uint8_t prev = proc->a;
		uint8_t b = proc->c+proc->getFlag(CARRY_FLAG);
		proc->a -= b;
		proc->setFlag(CARRY_FLAG,prev<proc->a);
		proc->setFlag(HALF_CARRY_FLAG,(prev&0xf- b&0xf)&0x10==0x10);
		proc->setFlag(ZERO_FLAG,proc->a==0);
		return 1;
	case 0x9a: //sbc a,d
		proc->setFlag(SUB_FLAG,1);
		uint8_t prev = proc->a;
		uint8_t b = proc->d+proc->getFlag(CARRY_FLAG);
		proc->a -= b;
		proc->setFlag(CARRY_FLAG,prev<proc->a);
		proc->setFlag(HALF_CARRY_FLAG,(prev&0xf- b&0xf)&0x10==0x10);
		proc->setFlag(ZERO_FLAG,proc->a==0);
		return 1;
	case 0x9b: //sbc a,e
		proc->setFlag(SUB_FLAG,1);
		uint8_t prev = proc->a;
		uint8_t b = proc->e+proc->getFlag(CARRY_FLAG);
		proc->a -= b;
		proc->setFlag(CARRY_FLAG,prev<proc->a);
		proc->setFlag(HALF_CARRY_FLAG,(prev&0xf- b&0xf)&0x10==0x10);
		proc->setFlag(ZERO_FLAG,proc->a==0);
		return 1;
	case 0x9c: //sbc a,h
		proc->setFlag(SUB_FLAG,1);
		uint8_t prev = proc->a;
		uint8_t b = proc->h+proc->getFlag(CARRY_FLAG);
		proc->a -= b;
		proc->setFlag(CARRY_FLAG,prev<proc->a);
		proc->setFlag(HALF_CARRY_FLAG,(prev&0xf- b&0xf)&0x10==0x10);
		proc->setFlag(ZERO_FLAG,proc->a==0);
		return 1;
	case 0x9d: //sbc a,l
		proc->setFlag(SUB_FLAG,1);
		uint8_t prev = proc->a;
		uint8_t b = proc->l+proc->getFlag(CARRY_FLAG);
		proc->a -= b;
		proc->setFlag(CARRY_FLAG,prev<proc->a);
		proc->setFlag(HALF_CARRY_FLAG,(prev&0xf- b&0xf)&0x10==0x10);
		proc->setFlag(ZERO_FLAG,proc->a==0);
		return 1;
	case 0x9e: //sbc a,(hl)
		proc->setFlag(SUB_FLAG,1);
		uint8_t prev = proc->a;
		uint8_t b = proc->memory->readMemory(proc->getHL())+proc->getFlag(CARRY_FLAG);
		proc->a -= b;
		proc->setFlag(CARRY_FLAG,prev<proc->a);
		proc->setFlag(HALF_CARRY_FLAG,(prev&0xf- b&0xf)&0x10==0x10);
		proc->setFlag(ZERO_FLAG,proc->a==0);
		return 2;
	case 0x9f: //sbc a,a
		proc->setFlag(SUB_FLAG,1);
		uint8_t prev = proc->a;
		uint8_t b = proc->a+proc->getFlag(CARRY_FLAG);
		proc->a -= b;
		proc->setFlag(CARRY_FLAG,prev<proc->a);
		proc->setFlag(HALF_CARRY_FLAG,(prev&0xf- b&0xf)&0x10==0x10);
		proc->setFlag(ZERO_FLAG,proc->a==0);
		return 1;
	}
}
}


#endif /* I80_9F_H_ */
