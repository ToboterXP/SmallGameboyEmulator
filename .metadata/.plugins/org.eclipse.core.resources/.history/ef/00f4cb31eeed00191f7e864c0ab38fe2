/*
 * i20_3f.h
 *
 *  Created on: 13.10.2019
 *      Author: Tobias
 */

#ifndef I20_3F_H_
#define I20_3F_H_

#include <cstdint>
#include "Processor.h"

namespace proc {

int execute20_3f(uint8_t opcode, Processor * proc) {
	switch (opcode) {
	case 0x20: //jr nz,r8
		int8_t jump = proc->getInstruction8();
		if (!(proc->getFlag(ZERO_FLAG))) {
			proc->pc += jump;
			return 3;
		}
		return 2;
	case 0x21: // ld hl,d16
		proc->setHL(proc->getInstruction16());
		return 3;
	case 0x22: //ld (hl+),a
		proc->memory->writeMemory(proc->getHL(),proc->a);
		proc->setHL(proc->getHL()+1);
		return 2;
	case 0x23: //inc hl
		proc->setHL(proc->getHL()+1);
		return 2;
	case 0x24: //inc h
		uint8_t prev = proc->h;
		proc->h++;
		proc->setFlag(ZERO_FLAG,proc->h==0);
		proc->setFlag(SUB_FLAG,0);
		proc->setFlag(HALF_CARRY_FLAG,(prev&0xf+1)&0x10==0x10);
		return 1;
	case 0x25: //dec h
		uint8_t prev = proc->h;
		proc->h--;
		proc->setFlag(ZERO_FLAG,proc->h==0);
		proc->setFlag(SUB_FLAG,1);
		proc->setFlag(HALF_CARRY_FLAG,(prev&0xf-1)&0x10==0x10);
		return 1;
	case 0x26: //ld h,d8
		proc->h = proc->getInstruction8();
		return 2;
	case 0x27: //daa
		return 1;
	}
}

}
#endif /* I20_3F_H_ */
